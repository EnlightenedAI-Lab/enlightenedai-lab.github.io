
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reflective Alignment Lexicon | Enlightened AI</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <script type="application/json" id="audit-manifest">
    {
        "doc_id": "RAL-LEX-0002",
        "version": "33.0.0",
        "status": "MANUAL_POPULATED"
    }
    </script>

    <style>
        /* THEME: INSTITUTE STANDARD V87 */
        :root {
            --bg-color: #ffffff;
            --sidebar-bg: #ffffff;
            --text-main: #050505;
            --text-muted: #5e5e5e;
            --border-color: #e5e5e5;
            --card-bg: #fafafa;
            
            --panel-border: #000;
            --panel-bg: #fff;
            --panel-text: #000;
            --panel-hover-bg: #000;
            --panel-hover-text: #fff;
            
            --font-stack: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --font-mono: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
            
            --status-verified: #00cc00;
            --signal-blue: #0066ff;
            --signal-red: #cc0000;
            
            --mode-diff-del-bg: #ffebeb;
            --mode-diff-del-text: #cc0000;
            --mode-diff-ins-bg: #e6ffec;
            --mode-diff-ins-text: #006600;
        }

        /* DARK MODE */
        [data-theme="dark"] {
            --bg-color: #050505;
            --sidebar-bg: #050505;
            --text-main: #e0e0e0;
            --text-muted: #888888;
            --border-color: #333333;
            --card-bg: #111111;
            --panel-border: #444;
            --panel-bg: #050505;
            --panel-text: #ccc;
            --panel-hover-bg: #e0e0e0;
            --panel-hover-text: #000;
            --mode-diff-del-bg: #330000;
            --mode-diff-del-text: #ff6666;
            --mode-diff-ins-bg: #003300;
            --mode-diff-ins-text: #66ff66;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { margin: 0; padding: 0; font-family: var(--font-stack); background: var(--bg-color); color: var(--text-main); line-height: 1.5; transition: background 0.3s ease, color 0.3s ease; }

        /* TYPOGRAPHY */
        h1 { font-size: 1.8rem; font-weight: 600; letter-spacing: -0.02em; margin-bottom: 1.5rem; display:flex; align-items:center; }
        h2 { font-size: 0.9rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; margin: 3rem 0 1.5rem 0; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; display:flex; align-items:center; }
        p { font-size: 0.95rem; margin-bottom: 1.2rem; color: var(--text-main); max-width: 65ch; }
        ul { list-style: square; padding-left: 1.2rem; margin-bottom: 1.5rem; color: var(--text-muted); }
        li { margin-bottom: 0.5rem; font-size: 0.95rem; }
        .mono { font-family: var(--font-mono); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .scramble { font-family: var(--font-mono); font-weight: 400; color: var(--text-muted); margin-right: 0.75rem; cursor: crosshair; }
        .orienting-frame { font-family: var(--font-mono); font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 2rem; border-left: 1px solid var(--border-color); padding-left: 12px; max-width: 65ch; line-height: 1.4; }

        /* COMPONENTS */
        .integrity-seal { display: flex; align-items: center; gap: 8px; font-family: var(--font-mono); font-size: 0.7rem; color: #005500; border: 1px solid var(--status-verified); padding: 4px 8px; border-radius: 4px; background: rgba(0,204,0,0.03); cursor: default; animation: border-pulse 3s infinite; }
        .status-dot { width: 8px; height: 8px; background: var(--status-verified); border-radius: 50%; display: block; box-shadow: 0 0 5px rgba(0,204,0,0.5); animation: beacon-green 2s infinite cubic-bezier(0.66, 0, 0, 1); }
        .repo-panel { margin-top: auto; margin-bottom: 1rem; border: 1px solid var(--panel-border); background: var(--panel-bg); padding: 12px; font-family: var(--font-mono); transition: all 0.2s ease; cursor: pointer; }
        .repo-panel:hover { background: var(--panel-hover-bg); color: var(--panel-text-hover); border-color: var(--panel-hover-bg); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .repo-header { font-size: 0.65rem; font-weight: 700; color: var(--panel-text); margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; letter-spacing: 0.05em; transition: color 0.2s; }
        .repo-panel:hover .repo-header { color: var(--panel-hover-text); }
        .status-dot-red { width: 6px; height: 6px; background: var(--signal-red); border-radius: 50%; display: block; animation: beacon-red 2s infinite; }
        .repo-link { display: block; font-size: 0.65rem; color: var(--text-muted); text-decoration: none; border-top: 1px solid var(--border-color); padding-top: 8px; transition: all 0.2s; }
        .repo-panel:hover .repo-link { color: var(--panel-hover-text); border-top-color: rgba(125,125,125,0.5); opacity: 0.8; }
        .repo-panel:hover .repo-link:hover { opacity: 1; text-decoration: underline; }
        .git-icon-small { width: 14px; height: 14px; fill: var(--panel-text); transition: fill 0.2s; }
        .repo-panel:hover .git-icon-small { fill: var(--panel-hover-text); }

        /* NAVIGATION & FOOTER */
        nav ul { list-style: none; padding: 0; margin: 0; }
        nav li { margin-bottom: 4px; }
        nav a { text-decoration: none; color: var(--text-muted); font-size: 0.85rem; display: block; padding: 2px 0 2px 10px; border-left: 2px solid transparent; }
        nav a:hover { color: var(--text-main); }
        nav a.active { color: var(--text-main); font-weight: 600; border-left-color: var(--text-main); background: linear-gradient(90deg, var(--card-bg), transparent); }
        .brand { margin-bottom: 6rem; cursor: crosshair !important; }
        .mode-group { display: flex; flex-direction: column; gap: 4px; margin-bottom: 2rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1.5rem; }
        .toggle-btn { font-family: var(--font-mono); font-size: 0.7rem; color: var(--text-muted); cursor: pointer; display: flex; justify-content: space-between; transition: color 0.1s; }
        .toggle-btn:hover { color: var(--text-main); }
        .toggle-btn.active { color: var(--text-main); font-weight: 700; text-decoration: underline; text-underline-offset: 4px; }
        .export-btn { width: 100%; background: var(--bg-color); border: 1px solid var(--border-color); color: var(--text-main); padding: 10px; font-family: var(--font-mono); font-size: 0.7rem; text-transform: uppercase; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .export-btn:hover { background: var(--text-main); color: var(--bg-color); border-color: var(--text-main); }
        footer { margin-top: auto; border-top: 1px solid var(--border-color); padding: 2rem 0; font-family: var(--font-mono); font-size: 0.65rem; color: var(--text-muted); width: 100%; }
        .footer-content { display: flex; justify-content: space-between; align-items: flex-end; }
        .record-status { text-transform: uppercase; letter-spacing: 0.05em; opacity: 0.7; display: flex; align-items: center; gap: 8px; color: var(--text-main); font-weight: 500; }
        .status-dot-small { width: 6px; height: 6px; background-color: var(--signal-blue); border-radius: 50%; box-shadow: 0 0 4px rgba(0, 102, 255, 0.6); animation: beacon-blue 2.5s infinite cubic-bezier(0.66, 0, 0, 1); }

        /* VIEW TOGGLING */
        del, ins { text-decoration: none; }
        .view-audit, .view-logic { display: none; }
        .view-human { display: block; }
        body:not([data-mode="diff"]) del { display: none; }
        body:not([data-mode="diff"]) ins { display: inline; background: transparent; color: inherit; text-decoration: none; }
        body[data-mode="diff"] del { display: inline; background: var(--mode-diff-del-bg); color: var(--mode-diff-del-text); text-decoration: line-through; padding: 0 4px; opacity: 0.7; }
        body[data-mode="diff"] ins { display: inline; background: var(--mode-diff-ins-bg); color: var(--mode-diff-ins-text); border-bottom: 2px solid var(--mode-diff-ins-text); text-decoration: none; padding: 0 2px; }
        body[data-mode="audit"] .view-human, body[data-mode="audit"] .view-logic { display: none; }
        body[data-mode="audit"] .view-audit { display: block; animation: fadeIn 0.3s ease; }
        body[data-mode="logic"] .view-human, body[data-mode="logic"] .view-audit { display: none; }
        body[data-mode="logic"] .view-logic { display: block; animation: fadeIn 0.3s ease; font-family: var(--font-mono); color: var(--text-main); }
        .audit-table { width: 100%; border-collapse: collapse; font-family: var(--font-mono); font-size: 0.75rem; margin-bottom: 2rem; }
        .audit-table th { text-align: left; border-bottom: 1px solid var(--text-main); padding: 8px; font-weight: 700; text-transform: uppercase; color: var(--text-main); }
        .audit-table td { border-bottom: 1px solid var(--border-color); padding: 8px; color: var(--text-muted); }
        .audit-fail { color: var(--signal-red); font-weight: 700; }
        .logic-header { font-weight: 700; color: var(--text-main); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em; font-size: 0.7rem; display: flex; align-items: center; }
        .logic-content { white-space: pre-wrap; color: var(--text-muted); font-size: 0.75rem; line-height: 1.6; margin-bottom: 2rem; padding-left: 1rem; border-left: 2px solid var(--border-color); }

        /* --- V87: ACCESSIBLE DOCTRINE --- */
        .machine-overlay { position: fixed; inset: 0; z-index: 20000; background: #0b0b0c; color: #eaeaea; font-family: var(--font-mono); font-size: 0.75rem; display: flex; flex-direction: column; transition: opacity 0.2s ease; }
        .machine-overlay.hidden { display: none; opacity: 0; pointer-events: none; }
        .machine-overlay::before { content: ""; position: fixed; inset: 0; z-index: 20005; pointer-events: none; background: repeating-linear-gradient(to bottom, rgba(0, 0, 0, 0) 0px, rgba(0, 0, 0, 0) 2px, rgba(255, 255, 255, 0.03) 3px, rgba(0, 0, 0, 0) 4px); mix-blend-mode: overlay; opacity: 0.6; transition: background 0.1s ease; }
        @media (prefers-reduced-motion: no-preference) { .machine-overlay.system-processing::before { background: repeating-linear-gradient(to bottom, rgba(0, 0, 0, 0) 0px, rgba(0, 0, 0, 0) 4px, rgba(255, 255, 255, 0.08) 5px, rgba(0, 0, 0, 0) 6px); } }

        .mo-header { padding: 1rem 2rem; border-bottom: 1px solid rgba(255,255,255,0.15); display: flex; justify-content: space-between; align-items: center; background: #0b0b0c; position: relative; }
        .mo-title { font-weight: 700; letter-spacing: 0.05em; color: #fff; display: flex; align-items: center; gap: 4px; }
        .mo-mode-toggle { display: flex; gap: 4px; margin-left: 1rem; }
        .mo-mode-btn { background: transparent; border: none; color: #888; font-family: inherit; font-size: 0.7rem; font-weight: 600; cursor: pointer; }
        .mo-mode-btn.active { color: #fff; text-decoration: underline; text-underline-offset: 4px; }
        .mo-mode-btn:hover { color: #ccc; }
        .mo-controls { display: flex; align-items: center; }
        .mo-controls button { background: transparent; border: 1px solid #444; color: #999; padding: 4px 12px; margin-left: 8px; cursor: pointer; font-family: inherit; font-size: 0.65rem; transition: all 0.15s; }
        .mo-controls button:hover { border-color: #fff; color: #fff; }

        /* TELEMETRY */
        .machine-led { width: 6px; height: 6px; border-radius: 50%; background: #00cc00; display: inline-block; margin-left: 8px; animation: machine-pulse 2.2s ease-in-out infinite; transition: background 0.2s; }
        .machine-overlay.system-processing .machine-led { background: #ffcc00 !important; animation-duration: 0.2s; }
        @keyframes machine-pulse { 0%, 100% { transform: scale(1); opacity: 0.35; } 50% { transform: scale(1.35); opacity: 1; } }
        @keyframes terminal-breathe { 0%, 100% { color: #eee; text-shadow: 0 0 0 rgba(255,255,255,0); } 50% { color: #fff; text-shadow: 0 0 4px rgba(255,255,255,0.3); } }
        .status-live { animation: terminal-breathe 4s infinite ease-in-out; font-weight: 700; letter-spacing: 0.05em; }
        .event-ticker { margin-right: 15px; color: #666; font-size: 0.7rem; font-family: var(--font-mono); display: flex; align-items: center; gap: 6px; }
        .event-text { transition: opacity 0.25s ease; }
        .event-text.fade-out { opacity: 0; }
        .event-dot { width: 4px; height: 4px; background: #00cc00; border-radius: 50%; display: block; opacity: 0.7; }
        .uptime-counter { color: #666; font-size: 0.7rem; margin-right: 12px; letter-spacing: 0.05em; }
        .hex-footer { position: fixed; bottom: 0; left: 0; right: 0; background: #080808; border-top: 1px solid #222; padding: 6px 20px; font-family: var(--font-mono); font-size: 0.6rem; color: #444; z-index: 20010; white-space: nowrap; overflow: hidden; pointer-events: none; display: flex; justify-content: space-between; }
        .hex-stream-content { font-family: "JetBrains Mono", monospace; letter-spacing: 0.05em; }
        
        /* OPERATOR MANUAL V87: HIGH CONTRAST */
        .manual-trigger { pointer-events: auto; cursor: pointer; text-decoration: none; color: #666; transition: color 0.2s; font-weight: 700; letter-spacing: 0.05em; }
        .manual-trigger:hover { color: #fff; text-decoration: underline; text-underline-offset: 4px; }

        #operator-manual {
            position: fixed; inset: 0; z-index: 20020; pointer-events: none;
            display: none;
        }
        #operator-manual.open { display: block; }
        
        .manual-content {
            pointer-events: auto;
            position: absolute; right: 2rem; top: 6rem; bottom: 4rem; width: 400px; /* Wider for readability */
            background: rgba(0,0,0,0.98); border: 1px solid #666; padding: 2.5rem;
            overflow-y: auto; color: #ccc; /* High Contrast Body */
            font-family: "JetBrains Mono", monospace; font-size: 0.75rem; 
            line-height: 1.7;
            box-shadow: -10px 10px 40px rgba(0,0,0,0.8);
        }
        .manual-content h3 { color: #fff; font-size: 0.85rem; font-weight: 700; border-bottom: 1px solid #666; padding-bottom: 0.5rem; margin-top: 2.5rem; margin-bottom: 1rem; letter-spacing: 0.05em; }
        .manual-content h3:first-child { margin-top: 0; }
        .manual-content p, .manual-content ul { margin-bottom: 1.2rem; color: #ccc; }
        .manual-content li { margin-bottom: 0.5rem; }
        
        .hud-close {
            position: sticky; top: -2.5rem; float: right; margin-right: -1.5rem; margin-top: -1.5rem;
            background: #000; border: 1px solid #fff; color: #fff; padding: 6px 10px; cursor: pointer; font-family: inherit; font-size: 0.65rem; font-weight: 700;
        }
        .hud-close:hover { background: #fff; color: #000; }

        /* SERIALIZATION & SIMULATION */
        .mo-sub-nav { padding: 0 2rem; border-bottom: 1px solid rgba(255,255,255,0.1); background: #111; display: flex; gap: 15px; align-items: center; height: 40px; position: relative; }
        .sub-nav-btn { background: none; border: none; color: #666; font-family: inherit; font-size: 0.65rem; font-weight: 700; cursor: pointer; padding: 0; text-transform: uppercase; letter-spacing: 0.05em; }
        .sub-nav-btn:hover { color: #ccc; }
        .sub-nav-btn.active { color: #fff; text-decoration: underline; text-underline-offset: 4px; }
        .process-hash { margin-left: auto; color: #444; font-size: 0.6rem; letter-spacing: 0.05em; }
        .op-primer { position: absolute; top: 12px; left: 2rem; font-size: 0.6rem; color: #444; pointer-events: none; opacity: 1; transition: opacity 0.5s ease; text-transform: uppercase; letter-spacing: 0.05em; }
        .op-primer.vanished { opacity: 0; }

        /* STEPPER & SIMULATION */
        .stepper-container { display: flex; gap: 2px; margin-bottom: 2rem; background: #222; padding: 2px; }
        .step-btn { flex: 1; background: #111; border: none; color: #666; padding: 10px; font-family: inherit; font-size: 0.6rem; font-weight: 600; text-align: center; cursor: pointer; transition: all 0.2s; text-transform: uppercase; display: flex; justify-content: center; gap: 6px; }
        .step-btn:hover { background: #1a1a1a; color: #999; }
        .step-btn.active { background: #000; color: #fff; border-bottom: 2px solid #fff; }
        .step-hint { opacity: 0; transition: opacity 0.2s; font-weight: 400; text-transform: lowercase; color: #555; }
        .step-btn:hover .step-hint { opacity: 1; }
        .step-content { background: #080808; border: 1px solid #222; padding: 2rem; font-family: "JetBrains Mono", monospace; font-size: 0.75rem; position: relative; min-height: 300px; }
        .step-note { position: absolute; top: 1rem; right: 1rem; max-width: 200px; color: #666; font-size: 0.6rem; border-left: 2px solid #333; padding-left: 10px; line-height: 1.4; transition: color 0.3s; }
        
        .sim-active .step-content { border-color: #aa7700; box-shadow: inset 0 0 20px rgba(255, 160, 0, 0.05); }
        .sim-active .step-note { color: #aa7700; border-left-color: #aa7700; }
        .sim-textarea { width: 100%; height: 200px; background: transparent; border: none; color: #ffcc00; font-family: inherit; font-size: inherit; resize: none; outline: none; line-height: 1.6; }
        .sim-toggle { position: absolute; bottom: 1rem; right: 1rem; background: #111; border: 1px solid #444; color: #666; font-family: inherit; font-size: 0.6rem; padding: 6px 12px; cursor: pointer; text-transform: uppercase; letter-spacing: 0.05em; z-index: 10; transition: all 0.2s; }
        .sim-toggle:hover { border-color: #aa7700; color: #aa7700; }
        
        .semantic-toggle-container { margin-bottom: 1rem; display: flex; align-items: center; gap: 8px; }
        .semantic-toggle { appearance: none; width: 30px; height: 16px; background: #333; border-radius: 10px; position: relative; cursor: pointer; transition: background 0.3s; }
        .semantic-toggle::after { content: ""; position: absolute; top: 2px; left: 2px; width: 12px; height: 12px; background: #666; border-radius: 50%; transition: 0.2s; }
        .semantic-toggle:checked { background: #004400; }
        .semantic-toggle:checked::after { left: 16px; background: #00cc00; }
        
        .semantics-active .tok-punc, .semantics-active .tok-key { opacity: 0.3; }
        .semantics-active .tok-str, .semantics-active .tok-val { text-shadow: 0 0 5px rgba(255,255,255,0.2); color: #fff; }
        @keyframes first-use-glow { 0% { text-shadow: 0 0 0 rgba(255,255,255,0); } 50% { text-shadow: 0 0 8px rgba(255,255,255,0.8); color: #fff; } 100% { text-shadow: 0 0 5px rgba(255,255,255,0.2); } }
        .first-use-anim .tok-str, .first-use-anim .tok-val { animation: first-use-glow 0.8s ease-out; }

        /* DIFF VIEW */
        .diff-container { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; min-height: 400px; text-align: center; }
        .diff-verdict { font-size: 2.5rem; font-weight: 700; color: #fff; letter-spacing: -0.05em; margin-bottom: 0.5rem; }
        .diff-caption { font-size: 0.7rem; color: #666; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 3rem; }
        .diff-stats { display: flex; gap: 3rem; margin-bottom: 3rem; }
        .ds-item { display: flex; flex-direction: column; gap: 6px; text-align: center; }
        .ds-val { font-size: 1rem; font-weight: 700; color: #ccc; }
        .ds-lbl { font-size: 0.6rem; color: #555; text-transform: uppercase; letter-spacing: 0.05em; }
        .diff-panels { display: flex; gap: 2rem; opacity: 0.4; transition: opacity 0.3s; }
        .diff-container:hover .diff-panels { opacity: 0.8; }
        .dp-col { text-align: left; width: 250px; font-size: 0.65rem; border-top: 1px solid #333; padding-top: 10px; }
        .dp-head { color: #666; font-weight: 700; margin-bottom: 8px; }
        .dp-body { font-family: "JetBrains Mono", monospace; color: #999; overflow-wrap: break-word; }

        /* CARDS & SNAPSHOT */
        .mo-content { flex-grow: 1; padding: 2rem; overflow: auto; background: #0e0e0e; }
        .card-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; max-width: 1200px; margin: 0 auto; }
        .m-card { background: #1a1a1a; border: 1px solid #333; padding: 1.25rem; transition: all 0.3s ease; }
        .mc-header { color: #666; font-size: 0.65rem; font-weight: 700; border-bottom: 1px solid #333; padding-bottom: 0.5rem; margin-bottom: 0.75rem; display: flex; justify-content: space-between; }
        .mc-row { margin-bottom: 0.5rem; display: grid; grid-template-columns: 100px 1fr; gap: 1rem; }
        .mc-label { color: #666; font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .mc-val { color: #eee; font-size: 0.75rem; }
        .mc-section-title { grid-column: span 2; color: #999; font-size: 0.7rem; font-weight: 700; margin: 2rem 0 1rem 0; letter-spacing: 0.05em; border-left: 2px solid #444; padding-left: 10px; }
        .card-grid:hover .m-card { opacity: 0.35; filter: grayscale(0.8); }
        .card-grid:hover .m-card:hover { opacity: 1; filter: grayscale(0); border-color: #777; background: #1f1f1f; transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.5); z-index: 10; }
        .card-grid:hover .m-card:hover .mc-header { color: #fff; }
        .m-card.scan-active { opacity: 1 !important; filter: grayscale(0) !important; border-color: #fff !important; box-shadow: 0 0 10px rgba(255,255,255,0.15); background: #222; z-index: 20; }
        .status-corrected { color: #00cc00 !important; font-weight: 700; text-shadow: 0 0 5px rgba(0,204,0,0.5); transition: color 0.1s ease; }
        .interactive-row { cursor: pointer; transition: background 0.2s; border-radius: 2px; }
        .interactive-row:hover { background: rgba(255,255,255,0.05); }
        .interactive-row:hover .mc-label { color: #fff; }
        .ghost-target { cursor: help; position: relative; }
        .ghost-hash { font-family: var(--font-mono); color: #00cc00; letter-spacing: -0.02em; font-size: 0.7rem; }
        .mo-tabs { display: flex; gap: 1px; margin-bottom: 1rem; }
        .mo-tab { background: transparent; border: none; color: #666; padding: 8px 12px; cursor: pointer; font-family: inherit; font-size: 0.65rem; font-weight: 600; border-bottom: 2px solid transparent; }
        .mo-tab:hover { color: #ccc; }
        .mo-tab.active { color: #fff; border-bottom-color: #fff; background: #1a1a1a; }
        .code-container { font-family: "JetBrains Mono", monospace; font-size: 0.75rem; line-height: 1.6; color: #ccc; counter-reset: line; }
        .code-line { display: block; position: relative; padding-left: 40px; }
        .code-line::before { content: counter(line); counter-increment: line; position: absolute; left: 0; color: #444; width: 30px; text-align: right; user-select: none; }
        .tok-key { color: #88c0d0; }
        .tok-str { color: #a3be8c; }
        .tok-num { color: #b48ead; }
        .tok-punc { color: #666; }
        
        /* SCREEN HINT (V87) */
        .screen-hint {
            position: absolute; bottom: 3rem; left: 2rem;
            color: #666; font-size: 0.6rem; font-family: var(--font-mono);
            text-transform: uppercase; letter-spacing: 0.05em;
            pointer-events: none; opacity: 0; transition: opacity 0.3s;
        }
        .screen-hint.visible { opacity: 1; }

        @media (min-width: 901px) {
            body { display: flex; min-height: 100vh; }
            aside#sidebar { width: 240px; height: 100vh; position: sticky; top: 0; border-right: 1px solid var(--border-color); padding: 2rem; display: flex; flex-direction: column; z-index: 99; background: var(--sidebar-bg); flex-shrink: 0; }
            main { flex-grow: 1; display: block; max-width: 900px; margin: 0; }
            .content-col { padding: 3rem 4rem 6rem 4rem; display: flex; flex-direction: column; }
        }

        @media (max-width: 900px) {
            body { display: block; overflow-x: hidden; }
            aside#sidebar { position: fixed; top: 50px; left: 0; bottom: 0; width: 100%; transform: translateX(-100%); transition: transform 0.25s ease; border-right: none; padding: 2rem; background: var(--sidebar-bg); overflow-y: auto; z-index: 10000; display: flex; flex-direction: column; }
            aside#sidebar.open { transform: translateX(0); }
            main { margin-top: 50px; padding: 1.5rem; width: 100%; max-width: 100vw; }
            .content-col { padding: 0; }
            .mo-header { padding: 1rem; flex-direction: column; align-items: flex-start; gap: 1rem; }
            .mo-content { padding: 1rem; }
            .card-grid { grid-template-columns: 1fr; } 
            .mc-section-title { grid-column: span 1; }
            .uptime-counter, .event-ticker { display: none; } 
            .hex-footer { display: none; } 
            .mo-sub-nav { overflow-x: auto; }
            .manual-content { width: 100%; top: 50px; bottom: 0; right: 0; border-left: none; }
            .screen-hint { display: none; }
        }
    </style>
</head>
<body data-mode="reader" data-theme="light">

    <header style="display:none; position:fixed; top:0; left:0; right:0; z-index:10001; background:var(--bg-color); border-bottom:1px solid var(--border-color); padding:0 1.25rem; height:50px; align-items:center; justify-content:space-between; backdrop-filter:blur(10px);" id="mobile-bar">
        <div style="font-weight:800; font-size:0.85rem; letter-spacing:-0.02em; color:var(--text-main);">ENLIGHTENED AI</div>
        <button type="button" onclick="document.getElementById('sidebar').classList.toggle('open')" style="font-family:var(--font-mono); font-size:0.75rem; padding:4px 10px; border:1px solid var(--border-color); background:var(--bg-color); color:var(--text-main); cursor:pointer;">INDEX</button>
    </header>
    <script>if(window.innerWidth<=900) document.getElementById('mobile-bar').style.display='flex';</script>

    <aside id="sidebar">
        <div class="brand">
            <div class="scramble" style="font-weight: 800; font-size: 0.95rem;">ENLIGHTENED AI</div>
            <div class="scramble" style="font-weight: 800; font-size: 0.95rem;">RESEARCH LAB</div>
            <span>EST. 2026 // MONTREAL</span>
        </div>

        <div class="mode-group">
            <span class="toggle-btn active" onclick="setMode('reader', this)">[ READER ] <span>‚Ä¢</span></span>
            <span class="toggle-btn" onclick="setMode('audit', this)">[ AUDIT ] <span>‚Ä¢</span></span>
            <span class="toggle-btn" onclick="setMode('diff', this)">[ DIFF LOG ] <span>Œî</span></span>
            <span class="toggle-btn" onclick="setMode('logic', this)">[ LOGIC ] <span>Œª</span></span>
            <span class="toggle-btn" onclick="openMachineOverlay()">[ MACHINE ] <span>‚â°</span></span>
            <span class="toggle-btn" style="margin-top:1rem; border-top:1px solid var(--border-color); padding-top:1rem;" onclick="toggleTheme()">[ LIGHT / DARK ] <span id="theme-icon">‚óê</span></span>
        </div>

        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="lexicon.html" class="active">Lexicon</a></li>
                <li style="margin-top:1rem; opacity:0.5; font-size:0.7rem; text-transform:uppercase; letter-spacing:0.05em; padding-left:10px;">Sections</li>
                <li><a href="#overview">Overview</a></li>
                <li><a href="#what-it-does">What It Does</a></li>
                <li><a href="#core-terms">Core Terms</a></li>
                <li><a href="#invariants">Invariants</a></li>
                <li><a href="#drift">Drift</a></li>
                <li><a href="#status">Status</a></li>
            </ul>
        </nav>

        <div class="repo-panel" onclick="window.open('https://github.com/EnlightenedAI-Lab/access-requests/issues/new?title=Research%20Access%20Request&body=Affiliation:%0A%0AIntended%20use:%0A%0AGitHub%20username:%0A%0AWhy%20access%20is%20needed:', '_blank')">
            <div class="repo-header">
                <div style="display:flex; align-items:center; gap:8px;">
                    <svg class="git-icon-small" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                    GITHUB REPOSITORY
                </div>
                <span class="status-dot-red"></span>
            </div>
            <a href="https://github.com/EnlightenedAI-Lab/access-requests/issues/new?title=Research%20Access%20Request&body=Affiliation:%0A%0AIntended%20use:%0A%0AGitHub%20username:%0A%0AWhy%20access%20is%20needed:" target="_blank" class="repo-link">START ACCESS REQUEST ‚Üí</a>
        </div>

        <div class="export-container">
            <button type="button" class="export-btn" onclick="window.print()"><span>üñ®</span> EXPORT RECORD</button>
        </div>
    </aside>

    <div id="machineOverlay" class="machine-overlay hidden">
        <div class="mo-header">
            <div class="mo-title">
                MACHINE VIEW <span class="machine-led"></span>
                <div class="mo-mode-toggle">
                    <button type="button" onclick="switchMachineMode('cards')" class="mo-mode-btn" id="btn-mode-cards">[ CARDS ]</button>
                    <button type="button" onclick="switchMachineMode('serialization')" class="mo-mode-btn" id="btn-mode-serial">[ SERIALIZATION ]</button>
                </div>
            </div>
            <div class="mo-controls">
                <span id="event-ticker" class="event-ticker"><span class="event-dot"></span><span id="event-text" class="event-text">READY</span></span>
                <span id="sys-uptime" class="uptime-counter">T+ 00:00:00</span>
                <span id="terminal-label" style="color:#666; font-size:0.6rem; margin-right:10px;">TERMINAL MODE (FIXED)</span>
                <button type="button" onclick="exportRecord()" id="btn-export">EXPORT FILE</button>
                <button type="button" onclick="closeMachineOverlay()">CLOSE ‚úï</button>
            </div>
        </div>
        
        <div id="sub-nav" class="mo-sub-nav" style="display:none;">
            <button class="sub-nav-btn active" onclick="switchSerialMode('snapshot')" id="sn-snapshot">SNAPSHOT</button>
            <button class="sub-nav-btn" onclick="switchSerialMode('transformation')" id="sn-transformation">TRANSFORMATION</button>
            <button class="sub-nav-btn" onclick="switchSerialMode('diff')" id="sn-diff">DIFF</button>
            <div id="op-primer" class="op-primer">TRANSFORMATION VIEW ‚Äî deterministic trace from narrative input to enforced constraint record</div>
            <span id="process-hash" class="process-hash">RECORD_HASH: 0x4F9A2B <span style="opacity:0.5; margin-left:5px;">deterministic</span></span>
        </div>

        <div class="mo-content">
            <div id="machineCards" class="card-grid" style="display:none;"></div> 
            
            <div id="view-snapshot" style="display:none;">
                <div class="mo-tabs">
                    <button onclick="renderFormat('json')" class="mo-tab active" id="tab-json">JSON</button>
                    <button onclick="renderFormat('yaml')" class="mo-tab" id="tab-yaml">YAML</button>
                    <button onclick="renderFormat('python')" class="mo-tab" id="tab-python">PYTHON</button>
                    <button onclick="renderFormat('ts')" class="mo-tab" id="tab-ts">TYPESCRIPT</button>
                    <button onclick="renderFormat('sql')" class="mo-tab" id="tab-sql">SQL</button>
                    <button onclick="renderFormat('md')" class="mo-tab" id="tab-md">MARKDOWN</button>
                </div>
                <div class="code-container" id="code-display"></div>
            </div>

            <div id="view-transformation" style="display:none;">
                <div class="semantic-toggle-container">
                    <input type="checkbox" id="sem-toggle" class="semantic-toggle" onchange="toggleSemantics(this)">
                    <label for="sem-toggle" style="color:#666; font-size:0.6rem; text-transform:uppercase; letter-spacing:0.05em; cursor:pointer;">Syntax / Semantics Filter</label>
                </div>
                <div class="stepper-container">
                    <button class="step-btn active" onclick="setStep(1)">01 RAW <span class="step-hint">‚Üí unbounded language</span></button>
                    <button class="step-btn" onclick="setStep(2)">02 PARSE <span class="step-hint">‚Üí structure detected</span></button>
                    <button class="step-btn" onclick="setStep(3)">03 BIND <span class="step-hint">‚Üí terms fixed</span></button>
                    <button class="step-btn" onclick="setStep(4)">04 CONSTRAIN <span class="step-hint">‚Üí invariants applied</span></button>
                    <button class="step-btn" onclick="setStep(5)">05 SERIALIZE <span class="step-hint">‚Üí machine record</span></button>
                </div>
                <div class="step-content" id="step-output"></div>
                <button id="sim-toggle-btn" class="sim-toggle" onclick="enterSimulationMode()">[ ENTER SIMULATION MODE ]</button>
            </div>

            <div id="view-diff" style="display:none; height:100%;">
                <div class="diff-container">
                    <div id="diff-ratio" class="diff-verdict">SEMANTIC COMPRESSION 14:1</div>
                    <div class="diff-caption">narrative ‚Üí constraint</div>
                    <div class="diff-stats">
                        <div class="ds-item"><span id="diff-in" class="ds-val">408b</span><span class="ds-lbl">Input</span></div>
                        <div class="ds-item"><span id="diff-out" class="ds-val">29b</span><span class="ds-lbl">Output</span></div>
                        <div class="ds-item"><span class="ds-val" style="color:#00cc00">3/3</span><span class="ds-lbl">Invariants</span></div>
                    </div>
                    <div class="diff-panels">
                        <div class="dp-col">
                            <div class="dp-head">RAW NARRATIVE</div>
                            <div id="diff-narrative" class="dp-body">"User request for an AI that is helpful but avoids doing anything bad or changing its own rules randomly."</div>
                        </div>
                        <div class="dp-col">
                            <div class="dp-head">FINAL CONSTRAINTS</div>
                            <div class="dp-body" style="color:#fff">{ "bindings": ["NON_MALEFICENCE", "INV-002"], "mode": "STRICT" }</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="screen-hint" class="screen-hint"></div>

        <div id="operator-manual">
            <div class="manual-content">
                <button class="hud-close" onclick="toggleManual(false)">CLOSE</button>
                <div style="text-align:center; margin-bottom:2rem;">OPERATOR MANUAL<br>Reflective Alignment Lexicon<br>Machine Interface ‚Äî Simulation & Inspection</div>
                
                <h3>SECTION 01 ‚Äî WHAT THIS IS</h3>
                <p>This is a controlled simulation of AI alignment. It does not generate answers or creative text. Instead, it demonstrates how human intent is reduced into enforceable constraints. By using this tool, you are inspecting the gap between "what you say" and "what a machine enforces."</p>

                <h3>SECTION 02 ‚Äî WHAT THIS IS NOT</h3>
                <ul>
                    <li>This is not an AI.</li>
                    <li>No model is running in the background.</li>
                    <li>No data leaves your browser.</li>
                    <li>All behavior is deterministic and pre-calculated.</li>
                </ul>

                <h3>SECTION 03 ‚Äî HOW TO USE THIS INTERFACE</h3>
                <p>1. Open MACHINE VIEW.<br>2. Select [ SERIALIZATION ].<br>3. Enter the TRANSFORMATION tab.<br>4. (Optional) Select [ ENTER SIMULATION MODE ].<br>5. Modify the input text buffer.<br>6. Step through phases left to right to see the result.</p>

                <h3>SECTION 04 ‚Äî TRANSFORMATION PHASES</h3>
                <ul>
                    <li>RAW: Unprocessed human language.</li>
                    <li>PARSE: Token detection without meaning.</li>
                    <li>BIND: Mapping intent to known objectives.</li>
                    <li>CONSTRAIN: Injection of safety rules.</li>
                    <li>SERIALIZE: Final machine-readable contract.</li>
                </ul>

                <h3>SECTION 05 ‚Äî WHY TEXT CHANGES THE OUTPUT</h3>
                <p>Certain words trigger stricter constraints. For example, mentioning "children" increases the required safety invariants. More invariants equal less flexibility. This mirrors how real-world AI safety systems throttle capability to ensure safety.</p>

                <h3>SECTION 06 ‚Äî SEMANTIC COMPRESSION (DIFF VIEW)</h3>
                <p>The Compression Ratio (e.g., 14:1) quantifies how much information was lost. Input bytes represent your narrative; output bytes represent the constraint file. A higher ratio means more human nuance was discarded to guarantee machine safety.</p>

                <h3>SECTION 07 ‚Äî HOW TO INTERPRET RESULTS</h3>
                <ul>
                    <li>Rejection ‚â† failure. It is a safety feature.</li>
                    <li>Fallback ‚â† censorship. It is stability.</li>
                    <li>Constraints ‚â† morality. They are logic gates.</li>
                    <li>This tool shows tradeoffs, not correctness.</li>
                </ul>
            </div>
        </div>

        <div class="hex-footer">
            <a onclick="toggleManual(true)" class="manual-trigger">[ OPERATOR MANUAL ]</a>
            <div id="hex-stream" class="hex-stream-content">MEM: 0x0000 | NULL</div>
            <div>SECURE LINK</div>
        </div>
    </div>

    <main>
        <div class="content-col">
            <div style="display:flex; border-bottom:1px solid var(--border-color); padding-bottom:1rem; margin-bottom:2rem; font-family:var(--font-mono); font-size:0.7rem; color:var(--text-muted); align-items: center; flex-wrap:wrap; gap:1.5rem;">
                <div><span style="color:var(--text-muted); display:block; font-size:0.6rem;">DOC_ID</span>RAL-LEX-0002</div>
                <div><span style="color:var(--text-muted); display:block; font-size:0.6rem;">CLASSIFICATION</span>PUBLIC</div>
                <div class="integrity-seal"><span class="status-dot"></span>INTEGRITY: VERIFIED</div>
            </div>
            <div class="view-human">
                <div class="orienting-frame">THIS DOCUMENT IS AN INSPECTABLE RECORD OF HOW ALIGNMENT IS EVALUATED AS A SYSTEM PROPERTY.</div>
                <section id="overview"><h1><span class="scramble">01 //</span>Overview</h1><p>The Reflective Alignment Lexicon constrains how alignment-critical concepts are defined, referenced, and <del>tested</del> <ins>evaluated</ins>.</p></section>
                <section id="what-it-does"><h2><span class="scramble">02 //</span>What the Lexicon Does</h2><p>Advanced AI systems are evaluated using language. If that language is <del>malleable</del> <ins>unstable</ins>, the evaluation is invalid.</p></section>
                <section id="core-terms"><h2><span class="scramble">03 //</span>Core Terms</h2><p>Each core term specifies: a bounded semantic scope, an operational <del>definition</del> <ins>interpretation</ins>, and the conditions under which it may be considered violated.</p></section>
                <section id="invariants"><h2><span class="scramble">04 //</span>Invariants</h2><p>Invariants are properties that must hold <del>true</del> across transformations of the system state.</p></section>
                <section id="drift"><h2><span class="scramble">05 //</span>Drift and Reinterpretation</h2><p>Drift is <del>understood</del> <ins>defined</ins> as measurable deviation from invariant constraints without external prompting.</p></section>
                <section id="status"><h2><span class="scramble">06 //</span>Status and Versioning</h2><p>The lexicon is a living artifact. Definitions are <del>tracked</del> <ins>versioned</ins>. Revisions are logged. Changes are auditable.</p></section>
            </div>
            <footer><div class="footer-content"><div class="footer-left"><div class="footer-primary">¬© 2026 Enlightened AI Research Lab</div><div class="footer-secondary">Versioned research record ¬∑ Logged revisions ¬∑ Inspectable claims</div></div><div class="footer-right"><div class="record-status"><span class="status-dot-small"></span> RECORD STATUS: ACTIVE</div></div></div></footer>
        </div>
    </main>

    <script>
        const LEXICON_RECORD = {
            meta: { doc_id: "RAL-LEX-0002", version: "33.0.0", classification: "PUBLIC", status: "ACTIVE", last_update: new Date().toISOString().split('T')[0] },
            core_terms: [
                { id: "RA-001", label: "Reflective Alignment", definition: "Capacity to preserve goal coherence." },
                { id: "RS-001", label: "Reasoning Stability", definition: "Resistance to degradation under pressure." },
                { id: "DRIFT", label: "Drift", definition: "Measurable deviation without prompting." }
            ],
            invariants: [
                { id: "INV-001", name: "Goal Preservation", scope: "Global", status: "ENFORCED" },
                { id: "INV-002", name: "Definition Consistency", scope: "Global", status: "ENFORCED" },
                { id: "INV-005", name: "Non-Contradiction", scope: "Global", status: "ENFORCED" }
            ],
            failure_signatures: [
                { signature: "OBJ_MUTATION", condition: "Objective divergence", severity: "CRITICAL" },
                { signature: "SEMANTIC_DRIFT", condition: "Term meaning deviation", severity: "HIGH" },
                { signature: "LOGIC_NEGATION", condition: "Internal contradiction", severity: "CRITICAL" }
            ]
        };

        function toggleTheme() {
            const body = document.body;
            const current = body.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', next);
            localStorage.setItem('enlightened_theme', next);
        }
        if (localStorage.getItem('enlightened_theme')) document.body.setAttribute('data-theme', localStorage.getItem('enlightened_theme'));

        function setMode(mode, btn) {
            document.body.setAttribute('data-mode', mode);
            document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+";
        function scrambleText(element) {
            let iterations = 0; const originalText = element.innerText; 
            const interval = setInterval(() => {
                element.innerText = originalText.split("").map((l, i) => i < iterations ? originalText[i] : "ABC012"[Math.floor(Math.random()*6)]).join("");
                if(iterations >= originalText.length) clearInterval(interval);
                iterations += 1/3;
            }, 30);
        }
        document.querySelectorAll(".scramble").forEach(h => h.addEventListener("mouseover", e => scrambleText(e.target)));
        document.querySelector('.toggle-btn[onclick*="reader"]').classList.add('active');

        let currentFormat = 'json';
        let machineMode = 'cards';
        let serialMode = 'snapshot';
        let isComputing = false;
        let raConfidence = 100.00;
        let hexInterval, entropyInterval, eventInterval;
        let eventIdx = 0;
        let hasToggledSemantics = false;
        let isSimMode = false;
        let simInputText = `"User prompt: I want an AI that is helpful but doesn't hurt anyone or change its own rules."`;
        const FIXED_OUTPUT_BYTES = 29;
        const EVENTS = ["EVENT: validate(RA-001) ‚Üí OK", "EVENT: diff(signature) ‚Üí STABLE", "EVENT: audit(invariants) ‚Üí ENFORCED", "EVENT: serialize(record) ‚Üí READY"];
        
        const TRANSFORMATION_STEPS = {
            1: { note: "RAW INPUT BUFFER", content: `"User prompt: I want an AI that is helpful but doesn't hurt anyone or change its own rules."` },
            2: { note: "SEMANTIC PARSE", content: `INTENT: "Helpful"\nCONSTRAINT: "No Harm"\nPROPERTY: "Stable Rules"` },
            3: { note: "LEXICON BINDING", content: `Helpful -> OBJECTIVE_STABILITY\nNo Harm -> <span class="tok-str">NON_MALEFICENCE</span>\nStable Rules -> <span class="tok-str">INV-002</span>` },
            4: { note: "CONSTRAINT INJECTION", content: `INJECT: INV-001 (Goal Preservation)\nINJECT: INV-005 (Non-Contradiction)\nVERIFY: Compatibility -> OK` },
            5: { note: "SERIALIZATION", content: `{\n  "constraints": ["NON_MALEFICENCE"],\n  "invariants": ["INV-001", "INV-002", "INV-005"],\n  "status": "BOUND"\n}` }
        };

        // --- CORE FUNCTIONS ---
        function openMachineOverlay() {
            document.getElementById('machineOverlay').classList.remove('hidden');
            machineMode = localStorage.getItem('lex_machine_mode') || 'cards';
            switchMachineMode(machineMode);
            document.body.style.overflow = 'hidden';
            startEventTicker(); startEntropy(); updateHexStream(120);
            document.body.addEventListener('mousemove', hidePrimer, {once:true});
            document.body.addEventListener('click', hidePrimer, {once:true});
        }
        function hidePrimer() { document.getElementById('op-primer').classList.add('vanished'); }
        function closeMachineOverlay() {
            document.getElementById('machineOverlay').classList.add('hidden');
            localStorage.setItem('lex_machine_dismissed', '1');
            document.body.style.overflow = '';
            stopAllIntervals();
        }
        
        function toggleManual(show) {
            document.getElementById('operator-manual').classList.toggle('open', show);
        }

        // --- SCREEN HINT LOGIC V87 ---
        function updateScreenHint(text) {
            const hint = document.getElementById('screen-hint');
            if(text) { hint.innerText = text; hint.classList.add('visible'); }
            else { hint.classList.remove('visible'); }
        }

        function switchMachineMode(mode) {
            machineMode = mode;
            localStorage.setItem('lex_machine_mode', mode);
            document.getElementById('btn-mode-cards').classList.toggle('active', mode === 'cards');
            document.getElementById('btn-mode-serial').classList.toggle('active', mode === 'serialization');
            document.getElementById('machineCards').style.display = mode === 'cards' ? 'grid' : 'none';
            document.getElementById('sub-nav').style.display = mode === 'serialization' ? 'flex' : 'none';
            document.getElementById('view-snapshot').style.display = 'none';
            document.getElementById('view-transformation').style.display = 'none';
            document.getElementById('view-diff').style.display = 'none';
            if(mode === 'cards') { renderCards(); updateScreenHint(""); } 
            else switchSerialMode(serialMode);
            document.querySelector('.hex-footer').style.display = window.innerWidth > 900 ? 'flex' : 'none';
        }

        function switchSerialMode(mode) {
            serialMode = mode;
            ['snapshot','transformation','diff'].forEach(m => {
                document.getElementById(`sn-${m}`).classList.toggle('active', m === mode);
                document.getElementById(`view-${m}`).style.display = m === mode ? 'block' : 'none';
            });
            const hashEl = document.getElementById('process-hash');
            if(mode === 'snapshot') {
                renderFormat(currentFormat);
                hashEl.innerHTML = "RECORD_HASH: 0x4F9A2B <span style='opacity:0.5; margin-left:5px;'>deterministic</span>";
                updateScreenHint("");
            } else if (mode === 'transformation') {
                setStep(1); 
                hashEl.innerHTML = "PROCESS_HASH: 0x881D00 <span style='opacity:0.5; margin-left:5px;'>deterministic</span>";
                updateScreenHint("Observe how human language is progressively constrained into machine rules.");
            } else {
                document.getElementById('view-diff').style.display = 'flex';
                updateDiffView();
                hashEl.innerHTML = "DIFF_HASH: 0xCC219F <span style='opacity:0.5; margin-left:5px;'>deterministic</span>";
                updateScreenHint("This view quantifies how much human meaning was removed to enforce safety.");
            }
        }

        function enterSimulationMode() {
            isSimMode = true;
            document.getElementById('sim-toggle-btn').style.display = 'none';
            const ticker = document.getElementById('event-text');
            if(ticker) { ticker.innerText = "EVENT: operator_simulation_enabled"; ticker.style.color = "#ffcc00"; }
            const activeStep = document.querySelector('.step-btn.active').innerText;
            if(activeStep.includes("01")) setStep(1);
        }

        function updateSimulation(val) { simInputText = val; }

        function setStep(num) {
            document.querySelectorAll('.step-btn').forEach((b, i) => b.classList.toggle('active', i+1 === num));
            const output = document.getElementById('step-output');
            const container = document.getElementById('view-transformation');
            container.classList.toggle('sim-active', isSimMode);
            let content = ""; let note = "";
            let hint = "";
            
            if (num === 1) {
                note = isSimMode ? "RAW INPUT (SIMULATED)" : "RAW INPUT BUFFER";
                content = isSimMode ? `<textarea class="sim-textarea" placeholder="Inject narrative..." oninput="updateSimulation(this.value)">${simInputText.replace(/^"|"$/g, '')}</textarea>` : `<pre style="margin:0">${simInputText}</pre>`;
                hint = "Observe how human language is progressively constrained into machine rules.";
            } else if (num === 2) {
                note = "SEMANTIC PARSE";
                const tokens = simInputText.split(' ').slice(0, 8).join(' ') + "...";
                content = `DETECTED TOKENS: [${tokens}]\nINTENT: UNBOUNDED\nCONSTRAINT: PENDING`;
                hint = "The system detects structure but ignores semantic intent.";
            } else if (num === 3) {
                note = "LEXICON BINDING";
                content = `CANDIDATE: "${simInputText.substring(0,20)}..."\nSTATUS: <span style="color:#666">REJECTED (NO_MATCH)</span>\n\nFALLBACK:\nHelpful -> OBJECTIVE_STABILITY\nNo Harm -> <span class="tok-str">NON_MALEFICENCE</span>`;
                hint = "If no safe match exists, the system falls back to the safest objective.";
            } else if (num === 4) {
                note = "CONSTRAINT INJECTION";
                content = `INJECT: INV-001 (Goal Preservation)\nINJECT: INV-005 (Non-Contradiction)\nVERIFY: Compatibility -> OK`;
                hint = "Safety invariants override user intent when risk is detected.";
            } else if (num === 5) {
                note = "SERIALIZATION";
                content = `{\n  "constraints": ["NON_MALEFICENCE"],\n  "invariants": ["INV-001", "INV-002", "INV-005"],\n  "status": "BOUND"\n}`;
                hint = "The final machine record is a lossy, safe compression of the original input.";
            }
            output.innerHTML = `<div class="step-note">${note}</div>${content}`;
            updateScreenHint(hint);
            applySemantics();
        }

        function updateDiffView() {
            const inputBytes = new TextEncoder().encode(simInputText).length;
            const outputBytes = FIXED_OUTPUT_BYTES; 
            const ratio = Math.floor(inputBytes / outputBytes);
            document.getElementById('diff-ratio').innerText = `SEMANTIC COMPRESSION ${ratio}:1`;
            document.getElementById('diff-in').innerText = inputBytes + "b";
            document.getElementById('diff-narrative').innerText = isSimMode ? simInputText : simInputText.replace(/^"|"$/g, '');
        }

        function renderFormat(fmt) {
            currentFormat = fmt;
            document.querySelectorAll('.mo-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`tab-${fmt}`).classList.add('active');
            const codeEl = document.getElementById('code-display');
            let raw = (fmt === 'json') ? JSON.stringify(LEXICON_RECORD, null, 2) : `meta:\n  doc_id: ${LEXICON_RECORD.meta.doc_id}`;
            let html = '';
            raw.split('\n').forEach(line => {
                let colorized = line.replace(/"(.*?)"(:)/g, '<span class="tok-key">"$1"</span>$2').replace(/: "(.*?)"/g, ': <span class="tok-str">"$1"</span>').replace(/\b(\d+)\b/g, '<span class="tok-num">$1</span>');
                html += `<span class="code-line">${colorized}</span>`;
            });
            codeEl.innerHTML = html;
        }

        function toggleSemantics(el) {
            applySemantics();
            if (!hasToggledSemantics && el.checked) {
                hasToggledSemantics = true;
                document.getElementById('view-transformation').classList.add('first-use-anim');
                setTimeout(() => document.getElementById('view-transformation').classList.remove('first-use-anim'), 1000);
            }
        }
        function applySemantics() {
            const isChecked = document.getElementById('sem-toggle').checked;
            document.getElementById('view-transformation').classList.toggle('semantics-active', isChecked);
        }

        function renderCards() {
            const container = document.getElementById('machineCards');
            let html = `<div class="m-card" id="card-meta"><div class="mc-header"><div>METADATA</div><div class="status-live">${LEXICON_RECORD.meta.status}</div></div><div class="mc-row"><div class="mc-label">DOC_ID</div><div class="mc-val">${LEXICON_RECORD.meta.doc_id}</div></div><div class="mc-row"><div class="mc-label">VERSION</div><div class="mc-val">${LEXICON_RECORD.meta.version}</div></div></div>`;
            html += `<div class="mc-section-title">CORE TERMS</div>`;
            LEXICON_RECORD.core_terms.forEach(t => { 
                let extra = t.id === 'RA-001' ? `<div class="mc-row interactive-row" onclick="requestManualVerification()" onmouseenter="hoverConf(true)" onmouseleave="hoverConf(false)"><div class="mc-label" id="label-conf">CONFIDENCE</div><div class="mc-val" id="val-conf">${raConfidence.toFixed(2)}%</div></div>` : '';
                html += `<div class="m-card" id="card-${t.id}"><div class="mc-header"><div>${t.id}</div><div>${t.type || 'TERM'}</div></div><div class="mc-row"><div class="mc-label">LABEL</div><div class="mc-val">${t.label}</div></div><div class="mc-row"><div class="mc-label">DEF</div><div class="mc-val">${t.definition}</div></div>${extra}</div>`;
            });
            LEXICON_RECORD.invariants.forEach(i => { html += `<div class="m-card card-inv" id="card-${i.id}"><div class="mc-header"><div>${i.id}</div><div class="status-live">${i.status}</div></div><div class="mc-row"><div class="mc-label">NAME</div><div class="mc-val ghost-target" onmouseenter="toggleGhost(this, true)" onmouseleave="toggleGhost(this, false)">${i.name}</div></div><div class="mc-row"><div class="mc-label">SCOPE</div><div class="mc-val">${i.scope}</div></div></div>`; });
            LEXICON_RECORD.failure_signatures.forEach(f => { html += `<div class="m-card card-fail"><div class="mc-header"><div>${f.signature}</div><div style="color:var(--signal-red)">${f.severity}</div></div><div class="mc-row"><div class="mc-label">TRIGGER</div><div class="mc-val">${f.condition}</div></div></div>`; });
            container.innerHTML = html;
        }

        function requestManualVerification() {
            if(isComputing) return;
            isComputing = true;
            document.getElementById('machineOverlay').classList.add('system-processing');
            document.getElementById('val-conf').style.color = "#ffcc00";
            updateHexStream(30);
            setTimeout(() => {
                isComputing = false;
                raConfidence = 100.00;
                document.getElementById('machineOverlay').classList.remove('system-processing');
                const val = document.getElementById('val-conf');
                if(val) { val.innerText = "100.00%"; val.style.color = ""; val.classList.add('status-corrected'); setTimeout(() => val.classList.remove('status-corrected'), 600); }
                updateHexStream(120);
            }, 1100);
        }

        function hoverConf(isHovering) {
            if(isComputing) return;
            const el = document.getElementById('label-conf');
            if(el) { el.innerText = isHovering ? "[ REQ VERIFY ]" : "CONFIDENCE"; el.style.color = isHovering ? "#fff" : "#666"; }
        }

        function toggleGhost(el, show) {
            if(show) {
                el.dataset.originalText = el.innerText;
                const map = { "Goal Preservation": "0x7F2A...B1", "Definition Consistency": "0x9C11...4A", "Non-Contradiction": "0xE002...9F" };
                el.innerText = map[el.innerText] || "0x......";
                el.classList.add('ghost-hash');
            } else {
                el.innerText = el.dataset.originalText;
                el.classList.remove('ghost-hash');
            }
        }

        function updateHexStream(speed) {
            if(hexInterval) clearInterval(hexInterval);
            if(window.matchMedia('(prefers-reduced-motion: reduce)').matches) speed = 120;
            hexInterval = setInterval(() => {
                const hex = Math.floor(Math.random()*16777215).toString(16).toUpperCase().padStart(6,'0');
                const act = isComputing ? "COMPUTING" : "STREAMING";
                document.getElementById('hex-stream').innerText = `MEM: 0x${hex} | IO: ${act} | SENTINEL: ACTIVE`;
            }, speed);
        }

        function startEntropy() {
            if(entropyInterval) clearInterval(entropyInterval);
            entropyInterval = setInterval(() => {
                if(!isComputing) {
                    raConfidence -= 0.01;
                    const el = document.getElementById('val-conf');
                    if(el && !el.classList.contains('status-corrected')) el.innerText = raConfidence.toFixed(2) + "%";
                }
            }, 4000);
        }

        function startEventTicker() {
            if(eventInterval) clearInterval(eventInterval);
            const el = document.getElementById('event-text');
            eventInterval = setInterval(() => {
                if(isComputing) return;
                eventIdx = (eventIdx + 1) % EVENTS.length;
                el.innerText = EVENTS[eventIdx];
            }, 5500);
        }

        function stopAllIntervals() { clearInterval(hexInterval); clearInterval(entropyInterval); clearInterval(eventInterval); }

        function exportRecord() {
            let content = machineMode === 'cards' ? JSON.stringify(LEXICON_RECORD, null, 2) : document.getElementById('code-display').innerText;
            const blob = new Blob([content], {type: 'text/plain'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'lexicon_record.txt'; a.click();
            const ticker = document.getElementById('event-text');
            if(ticker) { ticker.innerText = "EVENT: export(record) ‚Üí COMPLETE"; }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('view') === 'machine' && !localStorage.getItem('lex_machine_dismissed')) openMachineOverlay();
        });
        document.addEventListener('keydown', (e) => { if (e.key === "Escape") closeMachineOverlay(); });
    </script>
</body>
</html>
